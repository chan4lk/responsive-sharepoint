(function (a) { a.fn.dragdrop = function (b) { this.each(function () { a.dragdrop(this, b) }); return this }; a.dragdrop = function (b, c) { var d = { root: "", minX: 0, maxX: 0, minY: 0, maxY: 0, SwapHorz: false, SwapVert: false, onDragStart: null, onDragEnd: null, onDrag: null }; var e = { lastMouseX: 0, lastMouseY: 0, minMouseX: 0, minMouseY: 0, maxMouseX: 0, maxMouseY: 0, parentZ: "", rootZ: "", containerZ: "" }; if (c) a.extend(d, c); if (d.root == "") d.root = a(b).attr("id"); a(b).mousedown(function (b) { a.StartDrag(this, d, e, b) }); return false }; a.StartDrag = function (b, c, d, e) { var f = parseInt(c.SwapHorz ? a(c.root).css("right") : a(c.root).css("left")); var g = parseInt(c.SwapVert ? a(c.root).css("bottom") : a(c.root).css("top")); if (c.onDragBegin) c.onDragBegin.call(this, f, g); d.parentZ = a(c.root).parent().css("z-index"); d.rootZ = a(c.root).css("z-index"); d.containerZ = a(b).css("z-index"); a(c.root).parent().css("z-index", "999998"); a(c.root).css("z-index", "999998"); a(b).css("z-index", "999997"); d.lastMouseX = e.clientX; d.lastMouseY = e.clientY; d.minMouseX = 0; d.maxMouseX = a(window).width(); d.minMouseY = 0; d.maxMouseY = a(window).height(); if (c.SwapHorz) { if (c.minX > 0 || c.maxX > 0) { d.minMouseX = d.lastMouseX + f - c.minX; d.maxMouseX = d.minMouseX - c.maxX } } else { if (c.minX > 0 || c.maxX > 0) { d.minMouseX = d.lastMouseX - f + c.minX; d.maxMouseX = d.minMouseX + c.maxX } } if (c.SwapVert) { if (c.minY > 0 || c.maxY > 0) { d.maxMouseY = -c.minY + d.lastMouseY + g; d.minMouseY = -c.maxY + d.lastMouseY + g } } else { if (c.minY > 0 || c.maxY > 0) { d.minMouseY = d.lastMouseY - g + c.minY; d.maxMouseY = d.minMouseY + c.maxY } } var h = ""; h = "root x: " + f + " y: " + g + "<br />" + "last x: " + d.lastMouseX + " last y: " + d.lastMouseY + "<br />" + "min x: " + d.minMouseX + " max x: " + d.maxMouseX + "<br />" + "min y: " + d.minMouseY + " max y: " + d.maxMouseY + "<br />"; a("#ieconsole").html(h); a(document).mouseup(function (e) { return a.EndDrag(b, c, d, e) }); a(document).mousemove(function (e) { return a.WatchDrag(b, c, d, e) }); a(document).mousedown(function (a) { return false }); return false }; a.EndDrag = function (b, c, d, e) { a(document).unbind("mousemove"); a(document).unbind("mouseup"); a(document).unbind("mousedown"); a(c.root).parent().css("z-index", d.parentZ); a(c.root).css("z-index", d.rootZ); a(b).css("z-index", d.containerZ); if (c.onDragEnd) c.onDragEnd.call(this, parseInt(c.SwapHorz ? a(c.root).css("right") : a(c.root).css("left")), parseInt(c.SwapVert ? a(c.root).css("bottom") : a(c.root).css("top"))); return false }; a.WatchDrag = function (b, c, d, e) { var f = e.pageX; var g = e.pageY; var h = e.clientX; var i = e.clientY; var j = parseInt(c.SwapHorz ? a(c.root).css("right") : a(c.root).css("left")); var k = parseInt(c.SwapVert ? a(c.root).css("bottom") : a(c.root).css("top")); var l, m; h = c.SwapHorz ? Math.max(h, d.minMouseX) : Math.max(h, d.minMouseX); h = c.SwapHorz ? Math.min(h, d.maxMouseX) : Math.min(h, d.maxMouseX); i = c.SwapVert ? Math.max(i, d.minMouseY) : Math.max(i, d.minMouseY); i = c.SwapVert ? Math.min(i, d.maxMouseY) : Math.min(i, d.maxMouseY); l = j + (h - d.lastMouseX) * (c.SwapHorz ? -1 : 1); m = k + (i - d.lastMouseY) * (c.SwapVert ? -1 : 1); var n = ""; n = "new x: " + l + " y: " + m + "<br />" + "x: " + j + " " + h + " - " + d.lastMouseX + "<br />"; a("#ieconsole").html(n); a(c.root).css(c.SwapHorz ? "right" : "left", l + "px"); a(c.root).css(c.SwapVert ? "bottom" : "top", m + "px"); d.lastMouseX = h; d.lastMouseY = i; if (c.onDrag) c.onDrag.call(this, l, m); return false } })(jQuery)